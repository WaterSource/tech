## 项目点

### 有颜商城

#### 做了啥

* 网页加载加速
	* 浏览器提前初始化
	* sonic，离线包策略
	
* 数据管理

* 下载器

#### 难点

* 关于vasSonic的思路

	* 预先初始化WebView
		* 具体做法，预先初始化webview池
	* 静态直出
		* 服务端拉取数据渲染完毕，通过cdn加速访问
	* 并行加速
		* webview的打开和资源的请求并行
	* 动静分离
		* 将页面分为静态模板和动态数据，实现局部刷新
	* 预加载
		* 针对高频页面提前异步加载

sonicSession


### Whee Bee3D

#### 做了啥

* IM

* 视频聊天

#### 难点

* OC原生和Unity的交互
	* 传递函数地址

* 基于声网的视频推拉流
	* agora GPUImage

### 闪聊

#### 做了啥

* IM

* 会话列表

#### 难点

* 消息收发较多的情况下，发送成功的状态改变慢
	* 创建优先级不同的线程，分别处理发送回执、消息收取、其他的额外信令

* 列表的刷新太频繁
	* 利用`performSelector:afterDelay:`延后批量刷新，0.1刷新一次

* DB操作频繁
	* 读写分离
		* 读操作使用FM自带的`FMDatabaseQueue`串行线程，同步任务
		* 写操作，异步线程OperationQueue，并发执行任务。包起FM的串行线程，同步任务

* 会话列表的卡顿
	* 未读数机制
		* 刷新列表时会从数据库中检索当前还未读的消息，记录未读数
		* 在缓存中维护
	* 增加内存数据缓存
		* 原本每条消息都会单独处理DB，一条新消息会需要操作会话，用户信息等；
		* 统一处理同类型，避免大量的数据库读写操作

* 群会话头像
	* 检查前四位用户的头像地址，头像拼接之后保存在本地，本地位置写入数据库
	* 头像保存使用了SDImageCache<groupId: imageUrl>，本地文件保存群组前四位用户

	

