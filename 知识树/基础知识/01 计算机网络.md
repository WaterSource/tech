[TOC]

## 计算机网络

### HTTP特性

构建于TCP之上，是应用层的协议，默认端口号80；无连接无状态；

	URL 资源描述符
	
#### 会话跟踪

* 什么是会话

客户端打开与服务器的连接发出请求到服务器响应客户端请求的全过程，称之为会话；

* Cookie

Cookie是web服务器发送给客户端的一小段信息，客户端请求时可以读取该消息发送到服务器端，进而进行用户的识别；客户端的每次请求，服务器都会将Cookie发送到客户端，在客户端进行保存，以便下次使用；

Cookie可以保存在客户端内存中，称为临时Cookie，浏览器关闭后Cookie对象消失；另一种是保存在客户机的磁盘上，称为永久Cookie。

Cookie可以被客户端禁用；

* Session

每一个用户都有一个不同的session对象，不同用户之间不共享；

服务端会创建一个session对象，产生一个sessionId来标识这个session对象，然后将这个sessionId放到Cookie发送到客户端，用来识别不同的用户；

session的实现依赖cookie，cookie被禁用session也会失效；

### HTTPS

HTTPS 即 HTTP over TLS，是一种在加密信道进行http内容传输的协议；

	TLS的早期版本叫做SSL，但是基本已经被废弃。
	
TLS的基本过程如下

![](https://tva1.sinaimg.cn/large/006y8mN6gy1g8r3m9mqjsj30hw0fldhl.jpg)

1. 客户端发送`ClientHello`消息到服务端，包含TLS版本；
2. 服务端收到消息，向客户端发送`ServerHello`消息，消息包含服务端的TLS版本，公钥证书；其中证书中还包含了该证书所应用的域名范围，用于客户端验证身份；
3. 客户端根据内置的信任CA列表，验证服务端的证书是否可信；如果认为可信，会生成一串伪随机数(??)，并使用服务器的公钥加密；这串随机数会被用于生成新的对称密钥(通过什么方式生成的对称密钥？？)；
4. 服务端使用自己的私钥解密得到上一步的随机数，然后使用这串随机数生成自己的对称主密钥；
5. 客户端发送一个`Finished`消息给服务端，并使用对称密钥加密这次通讯；
6. 服务器生成自己的hash值，解密客户端发来的信息，检查两个值是否对应；如果对应，就向客户端发送一个`Finished`消息，同样使用对称密钥加密；
7. 接下来整个TLS会话都使用对称密钥进行加密，传输HTTP的内容;

#### 存在的风险及应对方案

中间人攻击

	引入HSTS技术，强制浏览器使用HTTPS访问网站；基本机制是在服务器返回的响应中，加上一个特殊的头部，指示浏览器对于此网站，强制使用HTTPS进行访问；
	
伪造证书攻击

攻击者挟持了DNS服务器，并且非法获得了合法证书；
	
	引入HPKP技术，在HSTS上更进一步，在返回头中储存公钥指纹信息，一旦发现指纹和接收到的公钥有差异，就认定正在被攻击；

### IP协议

IP协议位于TCP/IP协议的第三层 —— 网络层。与传输层协议相比，网络层的责任是提供点到点的服务，而传输层(TCP/UDP)则提供端到端的服务。

### TCP协议

TCP使用校验、确认、重传机制来保证可靠传输。

#### 三次握手

|  | 状态 | 标志位 SYN | 标志位 ACK | 内容 seq | 内容 ack |
|---|---|---|---|---|---|
| 第一次握手 客户端发起 | 客户端 SYN_SEND | 1 | - | x | - |
| 第二次握手 服务端发起 | 服务端 SYN_RCVD | 1 | 1 | y | x+1 |
| 第三次握手 客户端发起 | ESTABLISHED | - | 1 | - | y+1 |

#### 四次挥手

|  | 状态 | 标志位 FIN | 标志位 ACK | 内容 seq | 内容 ack |
|---|---|---|---|---|---|
| 第一次挥手 | | 1 | - | x | - |
| 第二次挥手 | | - | 1 | - | x+1 |
| 第三次挥手 | | 1 | - | y | - |
| 第四次挥手 | | - | 1 | - | y+1 |

最后会等待一个定长时间，没再收到消息就进入CLOSED状态；

#### SYN攻击

在连接过程中，出现大量不发送第三次握手的连接，使服务器存在大量半链接的session；服务端会不断的重试发送SYN包等待客户端确认，直至超时；

该攻击不能完全被阻止，规避方案

	* 缩短服务端超时时间
	* 增加最大半链接数
	* 过滤网关防护
	* SYN cookies技术

### UDP协议


