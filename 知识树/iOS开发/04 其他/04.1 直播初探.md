## 直播初探

### 简单流程

* 摄像头采集、屏幕采集
* 预处理(美颜、滤镜、水印)
* 编码
* 推流
* 流分发
* 流播放

### 采集

* 音频采集

采集到的原始数据是`PCM`，常用的压缩编码为`MP3`，再执行分发。

音频采样率常用的是44.1kHz。

主要问题是: 延时敏感、卡顿敏感、噪声消除、回声消除、静音检测、混音算法

* 图像采集

采集到的原始数据格式是`YUV`，经过压缩编码为`H.264`格式再执行分发。

主要问题是: 设备兼容性、延时敏感、卡顿敏感

### 处理

* GPUImage
* 美颜、滤镜、特效

### 编码和封装

* 编码格式基本能确定是`H.264`
	* `H.264`的色彩空间是`YUV`
		* `YUV444`，每一个Y都有一组UV分量
		* `YUV422`，每两个Y共用一组UV分量
		* `YUV420`，每四个Y共用一组UV分量
	* IBP帧
		* I帧，完整帧
		* P帧，依赖前面的I帧或者P帧
		* B帧，依赖前面和后面的I帧或者P帧
		
* 编码需要处理的问题
	* 处理硬件兼容性问题
	* 在音质画质和fps、码率之间找到平衡

* 封装是将编码器生成的多媒体内容(视频、音频、字幕、章节信息等)混合封装在一起的标准
	* 常见格式 avi、mp4、mpeg、rmvb
	* 直播常用的格式 `FLV`、`MPEG2-TS`

### 推流

推流的协议是为了优化推流阶段的网络不稳定问题，主流实现RTMP

* RTMP (Real Time Messaging Protocol)，实时消息传送协议
* RTSP (Real Time Streaming Protocol)，实时流传送协议
* HLS (HTTP Live Streaming)，Apple基于HTTP实现的流媒体传输协议

![](https://tva1.sinaimg.cn/large/00831rSTgy1gcmwzdr17pj30c20bwdgx.jpg)

### 拉流播放

解协议 -> 解封装 -> 解码音视频 -> 音视频同步

